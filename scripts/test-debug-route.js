#!/usr/bin/env node

// Script to test the debug route and help isolate Vercel issues
console.log('üîç Testing Job Profile Debug Route on Vercel...\n');

const testJobProfileId = '86040ae8-7251-40b7-b946-580dab98f40f'; // The failing job profile
const debugUrl = `https://cri-test-app.vercel.app/api/admin/job-profiles/${testJobProfileId}/route-debug`;

console.log('üìã Test Instructions:');
console.log('==================');
console.log('');
console.log('1. üåê BROWSER METHOD (Easiest):');
console.log('   a) Open Chrome DevTools (F12)');
console.log('   b) Go to Console tab');
console.log('   c) Paste this code and press Enter:');
console.log('');
console.log(`   fetch('${debugUrl}', {`);
console.log('     method: "PUT",');
console.log('     headers: {');
console.log('       "Content-Type": "application/json",');
console.log('       "Cookie": document.cookie // This passes your admin session');
console.log('     },');
console.log('     body: JSON.stringify({');
console.log('       name: "Debug Test Job Profile",');
console.log('       description: "Testing debug route",');
console.log('       positionIds: ["139ef7a2-74c3-426a-aab5-4784cfffd004"],');
console.log('       testIds: ["2a630186-8a11-4d20-986f-0d5096d7fcc7"]');
console.log('     })');
console.log('   })');
console.log('   .then(r => r.json())');
console.log('   .then(data => console.log("Debug Response:", data))');
console.log('   .catch(err => console.error("Debug Error:", err));');
console.log('');
console.log('2. üñ•Ô∏è CURL METHOD (Terminal):');
console.log('   (You need to get your session cookie from browser first)');
console.log('');
console.log(`   curl -X PUT '${debugUrl}' \\`);
console.log('     -H "Content-Type: application/json" \\');
console.log('     -H "Cookie: YOUR_SESSION_COOKIE_HERE" \\');
console.log('     -d \'{');
console.log('       "name": "Debug Test Job Profile",');
console.log('       "description": "Testing debug route",');
console.log('       "positionIds": ["139ef7a2-74c3-426a-aab5-4784cfffd004"],');
console.log('       "testIds": ["2a630186-8a11-4d20-986f-0d5096d7fcc7"]');
console.log('     }\'');
console.log('');
console.log('3. üìä WHAT TO LOOK FOR:');
console.log('   ‚úÖ Success Response:');
console.log('      { "success": true, "message": "Debug update successful", ... }');
console.log('');
console.log('   ‚ùå Error Responses:');
console.log('      ‚Ä¢ "Unauthorized" ‚Üí Session/auth issue');
console.log('      ‚Ä¢ "Validation failed" ‚Üí Request payload issue');
console.log('      ‚Ä¢ "Database connection failed" ‚Üí Prisma/DB issue');
console.log('      ‚Ä¢ "Update failed" ‚Üí Database operation issue');
console.log('      ‚Ä¢ "Debug route failed" ‚Üí Infrastructure issue');
console.log('');
console.log('4. üîç VIEW VERCEL LOGS:');
console.log('   a) Go to https://vercel.com/dashboard');
console.log('   b) Select your CRI Test App project');
console.log('   c) Go to "Functions" tab');
console.log('   d) Look for recent executions of the debug route');
console.log('   e) Check the logs for [DEBUG] messages');
console.log('');
console.log('5. üì± ALTERNATIVE - USE EXISTING UI:');
console.log('   a) Go to your job profiles page');
console.log('   b) Open browser DevTools ‚Üí Network tab');
console.log('   c) Try to edit any job profile');
console.log('   d) In Network tab, you\'ll see the failing request');
console.log('   e) Right-click on the failed request ‚Üí Copy as cURL');
console.log('   f) Modify the URL to add "/route-debug" at the end');
console.log('   g) Run the modified cURL command');
console.log('');
console.log('üìù REPORT BACK:');
console.log('   Copy the exact response you get and any [DEBUG] logs from Vercel');
console.log('   This will tell us exactly where the failure is happening!');
